#!/usr/bin/env bash

composer --version >/dev/null 2>&1 || { echo >&2 "Installer requires composer, but it's not available in \$PATH. Exiting."; exit 1; }

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
CALLER=$(ps ax | grep "^ *$PPID" | awk '{print $NF}')

symlinks=`find $DIR -type f -maxdepth 1 -name \.\*`

for file in $symlinks; do
  [ ! -h "${HOME}/$(basename $file)" ] && ln -s $file "${HOME}/$(basename $file)"
done

if [ -z "$(echo $CALLER | awk '/update/')" ]; then
  git branch --set-upstream master origin/master
  echo "Dotfiles have been installed."
else
  echo "Dotfiles have been updated."
fi

# install extra plugins
mkdir -p "${HOME}/.oh-my-zsh/custom/plugins"
cd ~/.oh-my-zsh/custom/plugins

git clone git://github.com/zsh-users/zsh-syntax-highlighting.git
git clone git://github.com/zsh-users/zsh-history-substring-search.git

# NPM packages
npm install -g diff-so-fancy
npm install -g npm-check-updates
