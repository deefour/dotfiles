# In your .zshenv.local export the following variables to work
# with this seedbox function
#
#  - D4_SEEDBOX_ID: your seedbox's AWS EC2 instance ID
#  - D4_SEEDBOX_IP: a free elastic IP to associate with the instance
#
# This function assumes you have the Amazon EC2 API Tools installed
# and available on $PATH.
seedbox () {
  mode="$1"

  command -v ec2-start-instances >/dev/null 2>&1 || {
    echo >&2 "The seedbox command require the Amazon EC2 API Tools be installed and available in \$PATH."
    return
  }

  if [[ "$mode" == "up" ]]
  then
    echo "Starting up the seedbox..."

    ec2-start-instances $D4_SEEDBOX_ID > /dev/null &&
    ec2-associate-address $D4_SEEDBOX_IP -i $D4_SEEDBOX_ID > /dev/null &&

    echo "The seedbox will be ready in a minute or two."
  elif [[ "$mode" == "down" ]]
  then
    echo "Stopping the seedbox..."

    ec2-stop-instances $D4_SEEDBOX_ID > /dev/null &&

    echo "The seedbox has been stopped"
  elif [[ -n "$mode" ]]
  then
    echo "Invalid argument. Only up or down are allowed"
    return
  else

    stat=`ec2-describe-instance-status $D4_SEEDBOX_ID | cut -f8`

    echo "The seedbox is currently ${stat:=stopped}"
  fi
}
